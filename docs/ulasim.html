<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ä°stanbul UlaÅŸÄ±m Analizi - AI Destekli</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation: slideDown 0.5s ease-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        color: #667eea;
        font-size: 2.5em;
        margin-bottom: 10px;
      }
      .subtitle {
        color: #666;
        font-size: 1.1em;
      }

      .nav-links {
        margin-top: 15px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      .nav-link {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 10px;
        text-decoration: none;
        transition: all 0.3s;
      }

      .nav-link.home {
        background: #6c757d;
        color: white;
      }

      .nav-link.home:hover {
        background: #5a6268;
      }

      .nav-link.map {
        background: #17a2b8;
        color: white;
      }

      .nav-link.map:hover {
        background: #138496;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
        animation: fadeIn 0.6s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .stat-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      }

      .stat-icon {
        font-size: 2.5em;
        margin-bottom: 10px;
      }
      .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
        margin: 10px 0;
      }
      .stat-label {
        color: #666;
        font-size: 0.9em;
      }

      .section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        animation: slideUp 0.7s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .section-title {
        color: #667eea;
        font-size: 1.8em;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .ilce-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border-left: 6px solid #667eea;
        transition: all 0.4s;
        animation: cardAppear 0.8s ease-out;
      }

      @keyframes cardAppear {
        from {
          opacity: 0;
          transform: translateX(-50px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .ilce-card:hover {
        transform: translateX(10px) scale(1.02);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .ilce-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .ilce-name {
        font-size: 1.6em;
        font-weight: bold;
        color: #333;
      }

      .priority-badge {
        padding: 8px 16px;
        border-radius: 25px;
        font-weight: bold;
        font-size: 0.9em;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      .priority-YÃ¼ksek {
        background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
        color: white;
      }
      .priority-Orta {
        background: linear-gradient(135deg, #ffa500, #ff8c00);
        color: white;
      }
      .priority-DÃ¼ÅŸÃ¼k {
        background: linear-gradient(135deg, #51cf66, #37b24d);
        color: white;
      }

      .ilce-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin: 15px 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 12px;
      }

      .ilce-stat {
        text-align: center;
      }
      .ilce-stat-value {
        font-size: 1.6em;
        font-weight: bold;
        color: #667eea;
      }
      .ilce-stat-label {
        font-size: 0.85em;
        color: #666;
        margin-top: 5px;
      }

      .problems-list {
        background: linear-gradient(135deg, #fff3cd, #ffe5a1);
        border-left: 4px solid #ffc107;
        padding: 18px;
        border-radius: 8px;
        margin: 15px 0;
      }

      .problems-list strong {
        font-size: 1.1em;
      }
      .problems-list ul {
        margin-left: 30px;
        margin-top: 10px;
      }
      .problems-list li {
        margin: 8px 0;
        color: #856404;
        font-weight: 500;
      }

      .project-proposal {
        background: linear-gradient(135deg, #d1ecf1, #bee5eb);
        border-left: 5px solid #17a2b8;
        padding: 25px;
        border-radius: 10px;
        margin-top: 20px;
      }

      .project-title {
        font-size: 1.3em;
        font-weight: bold;
        color: #0c5460;
        margin-bottom: 15px;
      }
      .project-description {
        color: #0c5460;
        margin: 15px 0;
        line-height: 1.8;
        font-size: 1.05em;
      }

      .project-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .project-detail {
        background: rgba(255, 255, 255, 0.9);
        padding: 15px;
        border-radius: 8px;
        transition: transform 0.3s;
      }

      .project-detail:hover {
        transform: translateY(-5px);
      }
      .project-detail-label {
        font-size: 0.85em;
        color: #666;
        margin-bottom: 8px;
        font-weight: 600;
      }
      .project-detail-value {
        font-weight: bold;
        color: #0c5460;
        font-size: 1.1em;
      }

      .alternatives {
        margin-top: 20px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 8px;
        border: 2px dashed #17a2b8;
      }

      .alternatives-title {
        font-weight: bold;
        color: #0c5460;
        margin-bottom: 12px;
        font-size: 1.1em;
      }
      .alternatives ul {
        margin-left: 25px;
      }
      .alternatives li {
        margin: 10px 0;
        color: #0c5460;
        line-height: 1.6;
      }

      .loading {
        text-align: center;
        padding: 60px 20px;
        font-size: 1.3em;
        color: #667eea;
      }

      .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-message {
        background: #f8d7da;
        border: 2px solid #f5c6cb;
        color: #721c24;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      footer {
        text-align: center;
        padding: 30px;
        color: white;
        margin-top: 40px;
      }

      .cost-total {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 25px;
        border-radius: 15px;
        margin: 30px 0;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .cost-total h3 {
        font-size: 1.5em;
        margin-bottom: 10px;
      }
      .cost-total .amount {
        font-size: 2.5em;
        font-weight: bold;
        margin: 15px 0;
      }

      .data-badge {
        display: inline-block;
        background: #51cf66;
        color: white;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.85em;
        margin-left: 10px;
        font-weight: bold;
      }

      .ced-badge {
        margin: 15px 0;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
      }

      .ced-badge:hover {
        transform: translateX(5px);
      }

      .ced-badge strong {
        color: #155724;
        font-size: 1.05em;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .ced-badge span {
        color: #0c5460;
        margin-top: 8px;
        display: block;
        line-height: 1.6;
        font-size: 1.02em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸš‡ Ä°stanbul UlaÅŸÄ±m Analizi</h1>
        <p class="subtitle">
          AI Destekli Eksiklik Analizi ve YatÄ±rÄ±m Ã–nerileri
          <span id="data-badge" class="data-badge">YÃ¼kleniyor...</span>
        </p>
        <div class="nav-links">
          <a href="/" class="nav-link home">â† Ana Sayfa</a>
          <a href="/ulasim/harita" class="nav-link map">ğŸ—ºï¸ Ä°nteraktif Harita</a>
        </div>
      </header>

      <div class="stats-grid" id="stats">
        <div class="stat-card">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-value" id="total-population">-</div>
          <div class="stat-label">Toplam NÃ¼fus</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸš‡</div>
          <div class="stat-value" id="total-metro">-</div>
          <div class="stat-label">Metro Ä°stasyonu</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ…¿ï¸</div>
          <div class="stat-value" id="total-parking">-</div>
          <div class="stat-label">Ä°SPARK Otopark</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-value" id="avg-score">-</div>
          <div class="stat-label">Ort. Eksiklik Skoru</div>
        </div>
        <!-- YENÄ° KART BURAYA EKLE â¬‡ï¸ -->
        <div class="stat-card" style="animation-delay: 0.4s">
          <div class="stat-icon">ğŸŒ</div>
          <div class="stat-value" id="ced-stats">-</div>
          <div class="stat-label">Ã‡ED Entegrasyonu</div>
        </div>
        <!-- YENÄ° KART BÄ°TÄ°Å â¬†ï¸ -->
      </div>

      <div class="section">
        <h2 class="section-title">ğŸ¤– AI YatÄ±rÄ±m Ã–nerileri</h2>
        <div id="content">
          <div class="loading">
            <div class="loading-spinner"></div>
            Veriler yÃ¼kleniyor...
          </div>
        </div>
      </div>

      <footer>
        <p>ğŸ¤– Claude AI ile desteklenmektedir | ğŸ“… 2024</p>
        <p style="margin-top: 10px; font-size: 0.9em">
          Proje: Ä°stanbul UlaÅŸÄ±m Eksiklik Analizi ve YatÄ±rÄ±m Ã–nerisi Sistemi
        </p>
      </footer>
    </div>

    <script>
      // Global deÄŸiÅŸkenler
      let allOneriler = [];
      let analizDataGlobal = null;

      window.addEventListener("load", async () => {
        await loadData();
      });

      async function loadData() {
        try {
          const analizResponse = await fetch("/api/ulasim/analiz-verisi");
          const analizData = await analizResponse.json();

          const onerilerResponse = await fetch("/api/ulasim/yatirim-onerileri");
          const onerilerData = await onerilerResponse.json();

          // Global deÄŸiÅŸkenleri gÃ¼ncelle
          allOneriler = onerilerData;
          analizDataGlobal = analizData;

          // KaÃ§ ilÃ§e verisi olduÄŸunu gÃ¶ster (data-badge gÃ¼venli eriÅŸim)
          const ilceSayisi = onerilerData.length;
          const dataBadge = document.getElementById("data-badge");
          if (dataBadge) {
            if (ilceSayisi === 39) {
              dataBadge.textContent = "âœ… 39 Ä°lÃ§e Tam Veri";
              dataBadge.style.background = "#51cf66";
            } else {
              dataBadge.textContent = `âš ï¸ ${ilceSayisi} Ä°lÃ§e`;
              dataBadge.style.background = "#ffa500";
            }
          } else {
            console.warn("data-badge Ã¶ÄŸesi DOM'da bulunamadÄ±.");
          }

          // DOMâ€™u gÃ¼ncelle (displayData iÃ§inde hata yakalama ekleyeceÄŸiz)
          try {
            displayData(analizData, onerilerData);
          } catch (e) {
            console.error("displayData Ã§alÄ±ÅŸÄ±rken hata:", e);
          }

          // Filtre sayÄ±larÄ±nÄ± gÃ¼ncelle (varsa)
          try {
            updateFilterCounts(onerilerData);
          } catch (e) {
            console.error("updateFilterCounts Ã§alÄ±ÅŸÄ±rken hata:", e);
          }

          // Filtre butonlarÄ±nÄ± aktif et (varsa)
          try {
            setupFilterButtons();
          } catch (e) {
            console.error("setupFilterButtons Ã§alÄ±ÅŸÄ±rken hata:", e);
          }

          // Ã‡ED istatistiklerini DOM yazÄ±mÄ± sonrasÄ±, kÄ±sa gecikme ile Ã§aÄŸÄ±r
          setTimeout(updateCedStats, 200);
        } catch (error) {
          console.error("Veri yÃ¼kleme hatasÄ±:", error);

          const badgeEl = document.getElementById("data-badge");
          if (badgeEl) {
            badgeEl.textContent = "âŒ Hata";
            badgeEl.style.background = "#e74c3c";
          }

          const contentEl = document.getElementById("content");
          if (contentEl) {
            contentEl.innerHTML = `
        <div class="error-message">
          âŒ Veriler yÃ¼klenemedi: ${error.message}
          <br><br>
          <strong>Ã‡Ã¶zÃ¼m:</strong> web_sunucu.py Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.
        </div>
      `;
          }
        }
      }

      function displayData(analizData, onerilerData) {
        // Ä°statistikleri gÃ¼venli gÃ¼ncelle
        if (analizData.genel_durum) {
          const popEl = document.getElementById("total-population");
          if (popEl) {
            popEl.textContent =
              (analizData.genel_durum.toplam_nufus / 1000000).toFixed(1) + "M";
          }

          const metroEl = document.getElementById("total-metro");
          if (metroEl) {
            metroEl.textContent =
              analizData.genel_durum.toplam_metro_istasyon || "241";
          }

          const parkEl = document.getElementById("total-parking");
          if (parkEl) {
            parkEl.textContent = analizData.genel_durum.toplam_otopark || "313";
          }

          const avgEl = document.getElementById("avg-score");
          if (avgEl) {
            const skor =
              (analizData.genel_durum.ortalama_eksiklik || 47.5).toFixed(1) +
              "/100";
            avgEl.textContent = skor;
          }
        }

        const contentDiv = document.getElementById("content");
        if (!contentDiv) {
          console.warn("#content Ã¶ÄŸesi bulunamadÄ±. Kartlar yazÄ±lamadÄ±.");
          return;
        }

        // Toplam maliyet ve HTML derleme
        let toplamMaliyet = 0;
        let html = "";

        onerilerData.forEach((oneri, index) => {
          const ilceAnaliz =
            analizData.en_sorunlu_ilceler?.find(
              (ilce) => ilce.ilce === oneri.ilce
            ) || {};

          // Maliyet hesaplama
          const maliyetText = oneri.tahmini_maliyet || "";
          const maliyetMatch = maliyetText.match(/â‚º([\d.,]+)/);
          if (maliyetMatch) {
            let maliyetStr = maliyetMatch[1].replace(",", ".");
            toplamMaliyet += parseFloat(maliyetStr);
          }

          const priorityClass = "priority-" + (oneri.oncelik || "Orta");

          html += `
      <div class="ilce-card" style="animation-delay: ${index * 0.05}s">
        <div class="ilce-header">
          <div class="ilce-name">${oneri.ilce}</div>
          <div class="priority-badge ${priorityClass}">
            ${oneri.oncelik || "Orta"} Ã–ncelik
          </div>
        </div>
        
        <div class="ilce-stats">
          <div class="ilce-stat">
            <div class="ilce-stat-value">${(
              (ilceAnaliz.nufus || 0) / 1000
            ).toFixed(0)}K</div>
            <div class="ilce-stat-label">NÃ¼fus</div>
          </div>
          <div class="ilce-stat">
            <div class="ilce-stat-value">${ilceAnaliz.metro_istasyon || 0}</div>
            <div class="ilce-stat-label">Metro</div>
          </div>
          <div class="ilce-stat">
            <div class="ilce-stat-value">${ilceAnaliz.otopark_sayisi || 0}</div>
            <div class="ilce-stat-label">Otopark</div>
          </div>
          <div class="ilce-stat">
            <div class="ilce-stat-value">${(
              ilceAnaliz.genel_eksiklik_skoru || 0
            ).toFixed(1)}</div>
            <div class="ilce-stat-label">Skor</div>
          </div>
          ${
            ilceAnaliz.trafik_yogunluk_skoru
              ? `
            <div class="ilce-stat">
              <div class="ilce-stat-value">${ilceAnaliz.trafik_yogunluk_skoru}</div>
              <div class="ilce-stat-label">Trafik</div>
            </div>
          `
              : ""
          }
        </div>
        
        ${
          oneri.sorunlar && oneri.sorunlar.length > 0
            ? `
          <div class="problems-list">
            <strong>âš ï¸ Tespit Edilen Sorunlar:</strong>
            <ul>
              ${oneri.sorunlar.map((s) => `<li>${s}</li>`).join("")}
            </ul>
          </div>
        `
            : ""
        }
        
        <div class="project-proposal">
          <div class="project-title">ğŸš€ ${oneri.proje_adi || "AI Ã–nerisi"}</div>
          ${
            oneri.ced_durumu
              ? `
            <div class="ced-badge" style="margin: 15px 0; padding: 15px; border-radius: 10px;
              ${
                oneri.ced_durumu.includes("Zaten planlanÄ±yor") ||
                oneri.ced_durumu.includes("mevcut")
                  ? "background: linear-gradient(135deg, #d4edda, #c3e6cb); border-left: 5px solid #28a745;"
                  : oneri.ced_durumu.includes("TamamlayÄ±cÄ±") ||
                    oneri.ced_durumu.includes("destek")
                  ? "background: linear-gradient(135deg, #fff3cd, #ffe5a1); border-left: 5px solid #ffc107;"
                  : "background: linear-gradient(135deg, #d1ecf1, #bee5eb); border-left: 5px solid #17a2b8;"
              }">
              <strong style="font-size: 1.1em; color: #155724;">ğŸŒ Ã‡ED Durumu:</strong>
              <span style="display: block; margin-top: 8px; color: #155724; line-height: 1.5;">
                ${oneri.ced_durumu}
              </span>
            </div>
          `
              : ""
          }
          
          <div class="project-description">${oneri.proje_detay || ""}</div>
          
          <div class="project-details">
            ${
              oneri.tahmini_maliyet
                ? `
              <div class="project-detail">
                <div class="project-detail-label">ğŸ’° Tahmini Maliyet</div>
                <div class="project-detail-value">${oneri.tahmini_maliyet}</div>
              </div>
            `
                : ""
            }
            ${
              oneri.beklenen_etki
                ? `
              <div class="project-detail">
                <div class="project-detail-label">ğŸ“ˆ Beklenen Etki</div>
                <div class="project-detail-value">${oneri.beklenen_etki}</div>
              </div>
            `
                : ""
            }
            ${
              oneri.uygulama_suresi
                ? `
              <div class="project-detail">
                <div class="project-detail-label">â±ï¸ Uygulama SÃ¼resi</div>
                <div class="project-detail-value">${oneri.uygulama_suresi}</div>
              </div>
            `
                : ""
            }
          </div>

          ${
            oneri.kisa_vade_etki || oneri.orta_vade_etki || oneri.uzun_vade_etki
              ? `
            <div class="alternatives">
              <div class="alternatives-title">ğŸ“… Zaman Ã‡izelgesi:</div>
              <ul>
                ${
                  oneri.kisa_vade_etki
                    ? `<li><strong>KÄ±sa Vade:</strong> ${oneri.kisa_vade_etki}</li>`
                    : ""
                }
                ${
                  oneri.orta_vade_etki
                    ? `<li><strong>Orta Vade:</strong> ${oneri.orta_vade_etki}</li>`
                    : ""
                }
                ${
                  oneri.uzun_vade_etki
                    ? `<li><strong>Uzun Vade:</strong> ${oneri.uzun_vade_etki}</li>`
                    : ""
                }
              </ul>
            </div>
          `
              : ""
          }

          ${
            oneri.yol_altyapisi
              ? `
            <div class="alternatives" style="background: rgba(255,243,205,0.7); border-color: #ff9800;">
              <div class="alternatives-title">ğŸ›£ï¸ Yol AltyapÄ±sÄ± Projeleri:</div>
              <p style="color: #0c5460; margin-top: 10px; line-height: 1.7;">${oneri.yol_altyapisi}</p>
            </div>
          `
              : ""
          }

          ${
            oneri.alternatif_cozumler && oneri.alternatif_cozumler.length > 0
              ? `
            <div class="alternatives">
              <div class="alternatives-title">ğŸ’¡ Alternatif Ã‡Ã¶zÃ¼mler:</div>
              <ul>
                ${oneri.alternatif_cozumler
                  .map((alt) => `<li>${alt}</li>`)
                  .join("")}
              </ul>
            </div>
          `
              : ""
          }
        </div>
      </div>`;
        });

        if (toplamMaliyet > 0) {
          const dolarMaliyet = (toplamMaliyet / 42).toFixed(0);
          html =
            `
      <div class="cost-total">
        <h3>ğŸ’° Toplam YatÄ±rÄ±m Ä°htiyacÄ±</h3>
        <div class="amount">â‚º${toplamMaliyet.toFixed(1)} Milyar</div>
        <p style="font-size: 1.2em; margin-top: 10px;">â‰ˆ $${dolarMaliyet} Milyon</p>
        <p style="margin-top: 10px;">${
          onerilerData.length
        } Ä°lÃ§e Ä°Ã§in Toplam Proje Maliyeti</p>
      </div>
    ` + html;
        }

        contentDiv.innerHTML = html;
      }

      // Ã‡ED istatistiklerini hesapla ve gÃ¶ster
      async function updateCedStats() {
        try {
          const response = await fetch("/api/ulasim/yatirim-onerileri");
          const data = await response.json();

          let zatenPlanlanan = 0;
          let tamamlayici = 0;
          let yeniOneri = 0;

          data.forEach((oneri) => {
            if (!oneri.ced_durumu) {
              yeniOneri++;
              return;
            }

            const cedDurum = oneri.ced_durumu.toLowerCase();
            if (
              cedDurum.includes("zaten planlan") ||
              cedDurum.includes("planlanÄ±yor")
            ) {
              zatenPlanlanan++;
            } else if (cedDurum.includes("tamamlayÄ±cÄ±")) {
              tamamlayici++;
            } else {
              yeniOneri++;
            }
          });

          const cedStatsEl = document.getElementById("ced-stats");
          if (cedStatsEl) {
            cedStatsEl.innerHTML = `
        <div style="font-size: 0.5em; line-height: 1.6; text-align: left;">
          <div style="margin: 2px 0;">âœ… Planlanan: ${zatenPlanlanan}</div>
          <div style="margin: 2px 0;">ğŸ”¶ TamamlayÄ±cÄ±: ${tamamlayici}</div>
          <div style="margin: 2px 0;">ğŸ†• Yeni: ${yeniOneri}</div>
        </div>
      `;
          } else {
            console.warn("ced-stats Ã¶ÄŸesi DOM'da bulunamadÄ±.");
          }
        } catch (error) {
          console.error("Ã‡ED stats hatasÄ±:", error);
          const cedStatsEl = document.getElementById("ced-stats");
          if (cedStatsEl) {
            cedStatsEl.innerHTML = `<div style="font-size: 0.6em; color: #e74c3c;">YÃ¼klenemedi</div>`;
          }
        }
      }

      // Filtreleme sayÄ±larÄ±nÄ± gÃ¼ncelle
      function updateFilterCounts(data) {
        let counts = {
          all: data.length,
          planlanan: 0,
          tamamlayici: 0,
          yeni: 0,
        };

        data.forEach((oneri) => {
          if (!oneri.ced_durumu) {
            counts.yeni++;
            return;
          }

          const cedDurum = oneri.ced_durumu.toLowerCase();
          if (
            cedDurum.includes("zaten planlan") ||
            cedDurum.includes("planlanÄ±yor")
          ) {
            counts.planlanan++;
          } else if (cedDurum.includes("tamamlayÄ±cÄ±")) {
            counts.tamamlayici++;
          } else {
            counts.yeni++;
          }
        });

        document.getElementById("count-all").textContent = counts.all;
        document.getElementById("count-planlanan").textContent =
          counts.planlanan;
        document.getElementById("count-tamamlayici").textContent =
          counts.tamamlayici;
        document.getElementById("count-yeni").textContent = counts.yeni;

        console.log("Filtre sayÄ±larÄ±:", counts);
      }

      // FiltrelenmiÅŸ veriyi gÃ¶ster
      function displayFilteredData(filter) {
        let filtered = allOneriler;

        if (filter === "planlanan") {
          filtered = allOneriler.filter((o) => {
            if (!o.ced_durumu) return false;
            const cedDurum = o.ced_durumu.toLowerCase();
            return (
              cedDurum.includes("zaten planlan") ||
              cedDurum.includes("planlanÄ±yor")
            );
          });
        } else if (filter === "tamamlayici") {
          filtered = allOneriler.filter(
            (o) =>
              o.ced_durumu && o.ced_durumu.toLowerCase().includes("tamamlayÄ±cÄ±")
          );
        } else if (filter === "yeni") {
          filtered = allOneriler.filter(
            (o) =>
              !o.ced_durumu || o.ced_durumu.toLowerCase().includes("yeni Ã¶neri")
          );
        }

        console.log(`${filter} filtresi: ${filtered.length} proje`);
        displayData(analizDataGlobal, filtered);
      }

      // Butonlara tÄ±klama olayÄ± ekle
      function setupFilterButtons() {
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            // Aktif sÄ±nÄ±fÄ± gÃ¼ncelle
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");

            // FiltrelenmiÅŸ veriyi gÃ¶ster
            const filter = btn.getAttribute("data-filter");
            displayFilteredData(filter);
          });
        });
      }
    </script>
  </body>
</html>
